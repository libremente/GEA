<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<p:panelGrid styleClass="infoTable" id="informazionigeneralipanel">


	<p:row>
		<p:column colspan="3">
			<p>
				<!-- Messaggio azioni -->
				<p:growl id="presaCaricoMsg" showDetail="true" sticky="false" />



				<!-- Confirm dialog -->
				<p:confirmDialog id="confirmAttoDialog"
					message="Sei sicuro di voler eliminare il File ?"
					header="Cancellazione Testo Atto" severity="alert"
					widgetVar="testoAttoDialog">

					<p:commandButton id="confirmTestoAtto" value="Conferma"
						oncomplete="testoAttoDialog.hide()"
						action="#{presentazioneAssegnazioneAttoController.removeTestoAtto}"
						update="listaTestiAtto" />
					<p:commandButton id="declineTestoAtto" value="Annulla"
						onclick="testoAttoDialog.hide()" type="button" />

				</p:confirmDialog>

				<p:confirmDialog id="confirmDialog"
					message="Sei sicuro di voler eliminare il Firmatario?"
					header="Cancellazione Firmatario" severity="alert"
					widgetVar="firmatarioDialog">

					<p:commandButton id="confirm" value="Conferma"
						oncomplete="firmatarioDialog.hide()"
						action="#{presentazioneAssegnazioneAttoController.removeFirmatario}"
						actionListener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}"
						update="listaFirmatari" />
					<p:commandButton id="decline" value="Annulla"
						onclick="firmatarioDialog.hide()" type="button" />

				</p:confirmDialog>


				<p:confirmDialog id="uploadFileAttributes" header="Caricamento"
					widgetVar="uploadFileAttributesDialog" style="width:450px" message="Allega Testo">
					<p:panelGrid id="uploadpanel">
						<p:row>
							<p:column>
								<h:outputLabel for="isPubblico" value="Pubblico: " />
								<p:selectBooleanCheckbox id="isPubblico" 
									value="#{presentazioneAssegnazioneAttoController.currentFilePubblico}">
									<p:ajax event="change" immediate="true" ></p:ajax>
								</p:selectBooleanCheckbox>
							</p:column>
							</p:row>
							<p:row>
							<p:column>
								<p:fileUpload label="Carica Testo dell'Atto"
									oncomplete="uploadFileAttributesDialog.hide()" auto="false"
									update="listaTestiAtto ,presaCaricoMsg"
									fileUploadListener="#{presentazioneAssegnazioneAttoController.uploadTestoAtto}" />
							</p:column>
							</p:row>
							<p:row>
							<p:column>
								<p:commandButton id="declineUploadFile" value="Annulla"
									onclick="uploadFileAttributesDialog.hide()" type="button" />
							</p:column>
							</p:row>
					</p:panelGrid>
				</p:confirmDialog>

				<b> <h:outputLabel for="datapresaincarico"
						value="Data presa in carico: " /> <p:calendar size="10"
						locale="it_IT" id="datapresaincarico"
						value="#{presentazioneAssegnazioneAttoController.dataPresaInCarico}" />
				</b>
				<p:commandButton value="Presa in Carico" update="presaCaricoMsg ,:informationForm:informationBar"
					actionListener="#{presentazioneAssegnazioneAttoController.presaInCarico}" oncomplete="unblockDiv()" />
			</p>
		</p:column>
	</p:row>
</p:panelGrid>
<div id="blockedInfoGen">
<p:fieldset legend="Dati dell'Atto" collapsed="false" toggleable="true"
	toggleSpeed="500">

	<p:panelGrid styleClass="infoTable" id="datiattopanel">
		<p:row>
			<p:column>
				<h:outputText style="font-weight: bold;" value="Numero Atto: " />
			</p:column>
			<p:column>
				<p:inputText readonly="true" id="inputnumeroatto"
					value="#{presentazioneAssegnazioneAttoController.numeroAtto}" />
			</p:column>


			<p:column>
				<h:outputText style="font-weight: bold;" value="Classificazione: " />
			</p:column>
			<p:column>
				<p:inputText readonly="true" id="inputclassificazione"
					value="#{presentazioneAssegnazioneAttoController.classificazione}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>
			</p:column>
		</p:row>

		<p:row>
			<p:column>
				<h:outputText style="font-weight: bold;" value="Oggetto: " />
			</p:column>
			<p:column colspan="3">
				<p:inputTextarea readonly="true" rows="2" cols="82"
					value="#{presentazioneAssegnazioneAttoController.oggetto}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputTextarea>
			</p:column>
		</p:row>

		<p:row>
			<p:column>
				<h:outputText style="font-weight: bold;" value="Numero repertorio: " />
			</p:column>
			<p:column>
				<p:inputText readonly="true" id="inputnumrepertorio"
					value="#{presentazioneAssegnazioneAttoController.numeroRepertorio}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>
			</p:column>

			<p:column>
				<b> <h:outputLabel for="datarepertorio"
						value="Data Repertorio: " /> </b>
			</p:column>

			<p:column>
				<p:inputText readonly="true" id="datarepertorio"
					value="#{presentazioneAssegnazioneAttoController.dataRepertorio}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>
				<!-- <p:calendar readonly="true" size="10" locale="it_IT" id="datarepertorio"
					pattern="dd/MM/yyyy"
					value="#{presentazioneAssegnazioneAttoController.dataRepertorio}">
					
				</p:calendar> -->
			</p:column>


		</p:row>

		<p:row>
			<p:column>
				<b> <h:outputText style="font-weight: bold;"
						value="Tipo Iniziativa: " /> </b>
			</p:column>

			<p:column>
				<p:inputText readonly="true" id="tipoiniziativa"
					value="#{presentazioneAssegnazioneAttoController.tipoIniziativa}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>

				<!-- <p:selectOneMenu id="tipoiniziativa"
					value="#{presentazioneAssegnazioneAttoController.tipoIniziativa}">
					<f:selectItem itemLabel="Scegli tipo" itemValue="" />
					<f:selectItems
						value="#{presentazioneAssegnazioneAttoController.tipiIniziativa}" />
					
				</p:selectOneMenu> -->
			</p:column>

			<p:column>
				<b><h:outputLabel for="datainiziativa" value="Data iniziativa: " />
				</b>
			</p:column>

			<p:column>
				<p:inputText readonly="true" id="datainiziativa"
					value="#{presentazioneAssegnazioneAttoController.dataIniziativa}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>

				<!-- <p:calendar size="10" locale="it_IT" id="datainiziativa"
					pattern="dd/MM/yyyy"
					value="#{presentazioneAssegnazioneAttoController.dataIniziativa}">
					
				</p:calendar> -->
			</p:column>


		</p:row>

		<p:row>
			<p:column>
				<h:outputText style="font-weight: bold;"
					value="Descrizione iniziativa: " />
			</p:column>
			<p:column colspan="3">
				<p:inputTextarea readonly="true" rows="2" cols="82"
					value="#{presentazioneAssegnazioneAttoController.descrizioneIniziativa}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputTextarea>
			</p:column>
		</p:row>

		<p:row>
			<p:column>
				<h:outputText style="font-weight: bold;" value="Numero DGR: " />

			</p:column>

			<p:column>
				<p:inputText readonly="true" id="inputnumerodgr"
					value="#{presentazioneAssegnazioneAttoController.numeroDgr}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>
			</p:column>

			<p:column>
				<b> <h:outputLabel for="datadgr" value="Data DGR: " /> </b>
			</p:column>

			<p:column>
				<p:inputText readonly="true" id="datadgr"
					value="#{presentazioneAssegnazioneAttoController.dataDgr}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>
				<!-- <p:calendar size="10" locale="it_IT" id="datadgr"
					pattern="dd/MM/yyyy"
					value="#{presentazioneAssegnazioneAttoController.dataDgr}">
					
				</p:calendar> -->
			</p:column>

		</p:row>

		<p:row>
			<p:column>
				<h:outputText style="font-weight: bold;" value="Assegnazione: " />
			</p:column>
			<p:column colspan="3">
				<p:inputText readonly="true" id="inputassegnazione"
					value="#{presentazioneAssegnazioneAttoController.assegnazione}">
					<p:ajax event="change"
						listener="#{presentazioneAssegnazioneAttoController.updateInfoGenHandler}" />
				</p:inputText>
			</p:column>
		</p:row>

	</p:panelGrid>

</p:fieldset>

<p:fieldset legend="Testo dell'Atto presentato" collapsed="false"
	toggleable="true" toggleSpeed="500">
	<p:panelGrid styleClass="infoTable" id="testoattopanel">
		<p:row>
			<!-- <p:column>
					<h:graphicImage alt="add" value="/resources/img/add.png" />
				</p:column>-->
			<p:column colspan="3">


				<p:commandButton value="Carica Testo dell'Atto"
					oncomplete="uploadFileAttributesDialog.show()">
				</p:commandButton>

				<!-- 
                    <h:outputText value="Pubblico : " />    
                    
				</p:fileUpload> -->
			</p:column>
		</p:row>
		<p:row>
			<p:column colspan="4">

				<h:dataTable id="listaTestiAtto"
					value="#{presentazioneAssegnazioneAttoController.testiAttoList}"
					var="testoAtto" styleClass="generalInfoTab grey-text">

					<h:column>
						<f:facet name="header">Testo Dell'Atto</f:facet>
							#{testoAtto.nome}
						</h:column>

					<h:column>
						<f:facet name="header">Documento</f:facet>
						<h:outputText
							value="#{fn:substring(testoAtto.nome, fn:indexOf(testoAtto.nome,'.')+1 ,fn:length(testoAtto.nome) )}" />

					</h:column>

					<h:column>
						<f:facet name="header">Pubblico</f:facet>
						<h:outputText value="si" rendered="#{testoAtto.pubblico}" />
						<h:outputText value="no" rendered="#{!testoAtto.pubblico}" />
					</h:column>

					<h:column>
						<f:facet name="header">Elimina</f:facet>
						<p:commandButton oncomplete="testoAttoDialog.show()"
							icon="delete-icon">

							<f:setPropertyActionListener value="#{testoAtto.id}"
								target="#{presentazioneAssegnazioneAttoController.testoAttoToDelete}" />
						</p:commandButton>
					</h:column>


				</h:dataTable>
			</p:column>
		</p:row>

	</p:panelGrid>
</p:fieldset>

<p:fieldset legend="Firmatari" toggleable="true" collapsed="false"
	toggleSpeed="500">
	<p:panelGrid styleClass="infoTable" id="firmataripanel">
		<!-- <p:row>
				<p:column>
					<p:commandButton value="Inserimento Multiplo" />
				</p:column>
			</p:row>-->

		<p:row>
			<p:column colspan="6">
				<p:panelGrid id="addFirmatarioPanel" styleClass="tableAppend">

					<f:facet name="header">
						<p:row>
							<p:column>Firmatario</p:column>
							<p:column>Gruppo Cons.</p:column>
							<p:column>Data Firma</p:column>
							<p:column>Data Ritiro</p:column>
							<p:column>Primo Firm.</p:column>
							<p:column></p:column>
						</p:row>
					</f:facet>
					<p:row>
						<p:column>
							<p:selectOneMenu id="firmatario"
								value="#{presentazioneAssegnazioneAttoController.nomeFirmatario}">
								<f:selectItem itemLabel="Scegli Firmatario" itemValue="" />
								<f:selectItems
									value="#{presentazioneAssegnazioneAttoController.firmatari}" />
							</p:selectOneMenu>
						</p:column>

						<p:column>
							<p:selectOneMenu id="gruppoconsiliare"
								value="#{presentazioneAssegnazioneAttoController.gruppoConsiliare}">
								<f:selectItem itemLabel="Scegli Gruppo" itemValue="" />
								<f:selectItems
									value="#{presentazioneAssegnazioneAttoController.gruppiConsiliari}" />
							</p:selectOneMenu>
						</p:column>

						<p:column>
							<p:calendar size="10" locale="it_IT" id="datafirma"
								pattern="dd/MM/yyyy"
								value="#{presentazioneAssegnazioneAttoController.dataFirma}" />
						</p:column>

						<p:column>
							<p:calendar size="10" locale="it_IT" id="dataritiro"
								pattern="dd/MM/yyyy"
								value="#{presentazioneAssegnazioneAttoController.dataRitiro}" />
						</p:column>

						<p:column>
							<p:selectBooleanCheckbox id="primofirmatario"
								value="#{presentazioneAssegnazioneAttoController.primoFirmatario}" />
						</p:column>

						<p:column>
							<p:commandButton value="Aggiungi"
								action="#{presentazioneAssegnazioneAttoController.addFirmatario}"
								id="addFirmatario" update="listaFirmatari , presaCaricoMsg"
								icon="new-icon" />
						</p:column>

					</p:row>
				</p:panelGrid>


			</p:column>
		</p:row>

		<p:row>
			<p:column colspan="6">

				<p:dataTable id="listaFirmatari"
					value="#{presentazioneAssegnazioneAttoController.firmatariList}"
					var="firmatarioAdd" styleClass="generalInfoTab grey-text"
					editable="true">

					<p:column headerText="Nome" style="width:125px">
						<h:outputText value="#{firmatarioAdd.descrizione}" />
						<!-- <p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{firmatarioAdd.descrizione}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu value="#{firmatarioAdd.descrizione}">
									<f:selectItems value="#{presentazioneAssegnazioneAttoController.firmatari}"/>

									</p:selectOneMenu>
							</f:facet>
						</p:cellEditor> -->
					</p:column>

					<p:column headerText="Gruppo Consiliare">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{firmatarioAdd.gruppoConsiliare}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu value="#{firmatarioAdd.gruppoConsiliare}">

									<f:selectItems />


								</p:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="Data Firma" style="width:100px">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{firmatarioAdd.dataFirma}">
									<f:convertDateTime locale="it_IT" pattern="dd/MM/yyyy" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<p:calendar size="10" locale="it_IT" pattern="dd/MM/yyyy"
									value="#{firmatarioAdd.dataFirma}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="Data Ritiro" style="width:100px">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{firmatarioAdd.dataRitiro}">
									<f:convertDateTime locale="it_IT" pattern="dd/MM/yyyy" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<p:calendar size="10" locale="it_IT" pattern="dd/MM/yyyy"
									value="#{firmatarioAdd.dataRitiro}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="1° firm." style="width:100px">

						<h:outputText value="si"
							rendered="#{firmatarioAdd.primoFirmatario}" />
						<h:outputText value="no"
							rendered="#{!firmatarioAdd.primoFirmatario}" />
					</p:column>

					<p:column headerText="Elimina" style="width:50px">

						<p:commandButton oncomplete="firmatarioDialog.show()"
							icon="delete-icon">

							<f:setPropertyActionListener value="#{firmatarioAdd.descrizione}"
								target="#{presentazioneAssegnazioneAttoController.firmatarioToDelete}" />
						</p:commandButton>
					</p:column>

					<p:column headerText="Modifica" style="width:50px">
						<p:rowEditor />
					</p:column>

				</p:dataTable>
			</p:column>
		</p:row>

		<p:row>
			<p:column>

			</p:column>

			<p:column colspan="5">
				<p:commandLink value="Creazione lettera di aggiunta firma" />
			</p:column>
		</p:row>

		<p:row>
			<p:column>

			</p:column>

			<p:column colspan="5">
				<p:commandLink value="Creazione lettera di ritiro firma" />
			</p:column>
		</p:row>

		<p:row>
			<p:column>
				<p:commandButton value="Ritiro per mancanza firmatari"
					action="#{presentazioneAssegnazioneAttoController.ritiraPerMancanzaFirmatari}" />
			</p:column>

			<p:column colspan="5">

			</p:column>
		</p:row>


	</p:panelGrid>

</p:fieldset>

<p>
	<p:commandButton value="Salva" update="presaCaricoMsg"
		actionListener="#{presentazioneAssegnazioneAttoController.salvaInfoGenerali}" />

</p>
</div>
<script type="text/javascript" src="resources/javascript/blockUI.js"></script>
<script>


if (! ("#{presentazioneAssegnazioneAttoController.dataPresaInCarico}").length) {
$('#blockedInfoGen').block({ message: null });

$.growlUI(null , 'Pagina bloccata! Prendere in carico per sbloccare.', 10000);};

function unblockDiv() { 
    $('#blockedInfoGen').unblock(); 
    $('#blockedAmmissibilita').unblock(); 
    $('#blockedAssegnazione').unblock(); 
    $('#blockedNote').unblock(); 
   };

</script>
</html>
