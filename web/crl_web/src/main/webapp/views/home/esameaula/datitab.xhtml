<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<pe:tooltip value="Click per Espandere / Comprimere"
	forSelector="legend" shared="true" targetPosition="top center"
	position="left center" />

  <!-- Confirm dialog -->
  <p:confirmDialog id="confirmRemoveAttoDialog"
    message="Sei sicuro di voler eliminare il File ?"
    header="Cancellazione Testo Atto" severity="alert"
    widgetVar="removeTestoAttoDialog">

    <p:commandButton id="confirmRemoveTestoAtto" value="Conferma"
      oncomplete="removeTestoAttoDialog.hide()"
      action="#{esameAulaController.removeTestoAtto}"
      update="listaTestiAtto" />
    <p:commandButton id="declineRemoveTestoAtto" value="Annulla"
      onclick="removeTestoAttoDialog.hide()" type="button" />

  </p:confirmDialog>

<p:panelGrid styleClass="infoTable" id="datiPanel1">
	<p:row>
		<p:column>
      
		Data presa in carico:
		</p:column>
		<p:column><div id="DataPresaInCaricoDiv">
			<p:calendar size="10" locale="it"
				value="#{esameAulaController.dataPresaInCarico}">
				<p:ajax event="dateSelect"
					listener="#{esameAulaController.updateVotazioneHandler}" />
			</p:calendar>
			</div>
		</p:column>
		<p:column><div id="presaInCaricoDiv">
			<p:commandButton disabled="#{navigationBean.presaCaricoAulaDisabled()}" value="Presa in carico" 
			action="#{esameAulaController.presaInCarico}"
			update="datiMsg , :informationForm:informationBar" oncomplete="unblockDiv()"/>
			</div>
		</p:column>
		
	</p:row>  
</p:panelGrid>

<div id="blockedDati">
  <p:growl id="datiMsg" showDetail="true" sticky="false" />
  
  <p:panelGrid styleClass="infoTable" id="datiPanel2">
    <p:row>
      <p:column>
        <p:fieldset legend="Dati dell'Atto" collapsed="false" toggleable="true"
          toggleSpeed="500">

          <p:panelGrid styleClass="infoTable" id="datiattopanel">
            <p:row>
              <p:column>
                <h:outputText style="font-weight: bold;" value="Numero Atto: " />
              </p:column>
              <p:column>
                <p:inputText readonly="true" id="inputnumeroatto"
                             value="#{esameAulaController.atto.numeroAtto}" />
              </p:column>


              <p:column>
                <h:outputText style="font-weight: bold;" value="Classificazione: " />
              </p:column>
              <p:column>
                <p:inputText readonly="true" id="inputclassificazione"
                  value="#{esameAulaController.atto.classificazione}">
                  <p:ajax event="change"
                          listener="#{esameAulaController.updateDatiHandler()}" />
                </p:inputText>
              </p:column>
            </p:row>

            <p:row>
              <p:column>
                <h:outputText style="font-weight: bold;" value="Oggetto: " />
              </p:column>
              <p:column colspan="3">
                <p:inputTextarea readonly="false" rows="2" cols="82"
                  value="#{esameAulaController.atto.oggetto}">
                  <p:ajax event="change"
                          listener="#{esameAulaController.updateDatiHandler()}" />
                </p:inputTextarea>
              </p:column>
            </p:row>

            <p:row>
              <p:column>
                <h:outputText style="font-weight: bold;"
                  value="Numero repertorio: " />
              </p:column>
              <p:column>
                <p:inputText readonly="true" id="inputnumrepertorio"
                  value="#{esameAulaController.atto.numeroRepertorio}">
                  <p:ajax event="change"
                          listener="#{esameAulaController.updateDatiHandler()}" />
                </p:inputText>
              </p:column>

              <p:column>
                <b> <h:outputLabel for="datarepertorio"
                    value="Data Repertorio: " /> </b>
              </p:column>

              <p:column>

                <p:calendar disabled="true" readonly="false" size="10"
                  locale="it_IT" id="datarepertorio" pattern="dd/MM/yyyy"
                  value="#{esameAulaController.atto.dataRepertorio}">

                </p:calendar>
              </p:column>


            </p:row>

            <p:row>
              <p:column>
                <b> <h:outputText style="font-weight: bold;"
                    value="Tipo Iniziativa: " /> </b>
              </p:column>

              <p:column>
                <p:selectOneMenu id="tipoiniziativa"
                  value="#{esameAulaController.atto.tipoIniziativa}">
                  <f:selectItem itemLabel="Consiliare" itemValue="01_ATTO DI INIZIATIVA CONSILIARE" />
  
                  <f:selectItem itemLabel="Popolare" itemValue="03_ATTO DI INIZIATIVA POPOLARE" />
              
                  <f:selectItem itemLabel="d'Ufficio" itemValue="05_ATTO DI INIZIATIVA UFFICIO DI PRESIDENZA" />
              
                  <f:selectItem itemLabel="Consiglio delle Autonomie locali"
                  itemValue="07_ATTO DI INIZIATIVA AUTONOMIE LOCALI" />
                
                  <f:selectItem itemLabel="Presidente della Giunta"
                                itemValue="06_ATTO DI INIZIATIVA PRESIDENTE GIUNTA" />
                  <f:selectItem itemLabel="Giunta" itemValue="02_ATTO DI INIZIATIVA GIUNTA" />
                  <f:selectItem itemLabel="Iniziativa Commissioni" itemValue="04_ATTO DI INIZIATIVA COMMISSIONI" />

                </p:selectOneMenu>
              </p:column>

              <p:column>
                <b><h:outputLabel for="datainiziativa"
                    value="Data iniziativa: " /> </b>
              </p:column>

              <p:column>


                <p:calendar size="10" locale="it_IT" id="datainiziativa"
                  pattern="dd/MM/yyyy"
                  value="#{esameAulaController.atto.dataIniziativa}">

                </p:calendar>
              </p:column>


            </p:row>

            <p:row>
              <p:column>
                <h:outputText style="font-weight: bold;"
                  value="Descrizione iniziativa: " />
              </p:column>
              <p:column colspan="3">
                <p:inputTextarea readonly="false" rows="2" cols="82"
                  value="#{esameAulaController.atto.descrizioneIniziativa}">
                  <p:ajax event="change"
                          listener="#{esameAulaController.updateDatiHandler()}" />
                </p:inputTextarea>
              </p:column>
            </p:row>

            <p:row>
              <p:column>
                <h:outputText style="font-weight: bold;" value="Numero DGR: " />

              </p:column>

              <p:column>
                <p:inputText readonly="false" id="inputnumerodgr"
                             value="#{esameAulaController.atto.numeroDgr}">
                  <p:ajax event="change"
                          listener="#{esameAulaController.updateDatiHandler()}" />
                </p:inputText>
              </p:column>

              <p:column>
                <b> <h:outputLabel for="datadgr" value="Data DGR: " /> </b>
              </p:column>

              <p:column>


                <p:calendar size="10" locale="it_IT" id="datadgr"
                  pattern="dd/MM/yyyy"
                  value="#{esameAulaController.atto.dataDgr}">

                </p:calendar>
              </p:column>

            </p:row>

            <!-- <p:row>
              <p:column>
                <h:outputText style="font-weight: bold;" value="Assegnazione: " />
              </p:column>
              <p:column colspan="3">
                <p:inputText readonly="false" id="inputassegnazione"
                  value="#{esameAulaController.atto.assegnazione}">
                  <p:ajax event="change"
                    listener="#{esameAulaController.updateDatiHandler()}" />
                </p:inputText>
              </p:column>
            </p:row> -->

            <p:row>
              <p:column>
                <h:outputText style="font-weight: bold;" value="Pubblicazione atto: " />
              </p:column>

              <p:column colspan="3">
                <p:selectBooleanCheckbox readonly="false" id="ispubblico"
                  value="#{esameAulaController.atto.pubblico}">
                  <p:ajax event="change"
                    listener="#{esameAulaController.updateDatiHandler}" />
                </p:selectBooleanCheckbox>
              </p:column>

            </p:row>

          </p:panelGrid>

        </p:fieldset>

        <p:fieldset legend="Testo dell'Atto presentato" collapsed="false"
          toggleable="true" toggleSpeed="500">
          <p:panelGrid styleClass="infoTable" id="testoattopanel">
            <p:row>
              <!-- <p:column>
                <h:graphicImage alt="add" value="/resources/img/add.png" />
              </p:column>-->
              <p:column colspan="3">


                <p:commandButton value="Carica Testo dell'Atto"
                  oncomplete="uploadFileAttributesDialog.show()">
                </p:commandButton>

                <!-- 
                          <h:outputText value="Pubblico : " />    

              </p:fileUpload> -->
              </p:column>
            </p:row>
            <p:row>
              <p:column colspan="4">

                <p:dataTable id="listaTestiDatiAtto"
                  value="#{esameAulaController.atto.testiAtto}"
                  var="testoAtto" styleClass="generalInfoTab grey-text" editable="true">

                  <p:ajax event="rowEdit" update="@this" listener="#{fileDownloadController.fileUpdate}" />

                  <p:column sortBy="#{testoAtto.nome}">
                    <f:facet name="header">Testo Dell'Atto</f:facet>
                    <h:outputText value="#{testoAtto.nome}" />
                  </p:column>

                  <p:column sortBy="#{testoAtto.mimetype}">
                    <f:facet name="header">Formato</f:facet>



                    <h:outputText value="#{testoAtto.mimetype}" />


                  </p:column>

                  <p:column sortBy="#{testoAtto.pubblico}">
                    <f:facet name="header">Pubblico</f:facet>
                    <p:cellEditor >
                      <f:facet name="output">
                        <h:outputText value="si"
                      rendered="#{testoAtto.pubblico}" />
                    <h:outputText value="no"
                      rendered="#{!testoAtto.pubblico}" />
                      </f:facet>
                      <f:facet  name="input">
                        <p:selectBooleanCheckbox 
                        value="#{testoAtto.pubblico}" />
                      </f:facet>
                    </p:cellEditor> 

                  </p:column>

                  <p:column>
                    <f:facet name="header">Download</f:facet>

                    <p:commandButton id="downloadLink" icon="detail-icon"
                      ajax="false" onclick="PrimeFaces.monitorDownload(start, stop)">
                      <f:setPropertyActionListener value="#{testoAtto.id}"
                        target="#{fileDownloadController.fileId}" />
                      <f:setPropertyActionListener value="#{testoAtto.nome}"
                        target="#{fileDownloadController.fileName}" />
                      <f:setPropertyActionListener value="#{testoAtto.mimetype}"
                        target="#{fileDownloadController.fileMimetype}" />
                      <p:fileDownload value="#{fileDownloadController.file}" />
                    </p:commandButton>

                  </p:column>

                  <p:column>
                    <f:facet name="header">Elimina</f:facet>
                    <p:commandButton oncomplete="removeTestoAttoDialog.show()"
                      icon="delete-icon">

                      <f:setPropertyActionListener value="#{testoAtto.id}"
                        target="#{esameAulaController.testoAttoToDelete}" />
                    </p:commandButton>
                  </p:column>

                  <p:column headerText="Modifica" style="width:50px">
                    <p:rowEditor   />
                  </p:column>


                </p:dataTable>
              </p:column>
            </p:row>

          </p:panelGrid>
        </p:fieldset>  
      </p:column>
    </p:row>
  </p:panelGrid>

	<p>
		<p:commandButton value="Salva" update="datiMsg"
			actionListener="#{esameAulaController.salvaInfoGenerali}" />

	</p>  
  
</div>

<script>
  if (! ("#{esameAulaController.dataPresaInCarico}").length &amp;&amp; #{navigationBean.isGuest()}==false) {
$('#blockedDati').block({ message: 'Pagina bloccata!<br />Prendere in carico per sbloccare.', css: {
	width:		'350px',
	top:		'10px',
	left:		'',
	right:		'10px',
	border:		'none',
	padding:	'5px',
	opacity:	0.6,
	cursor:		'default',
	color:		'#fff',
	backgroundColor: '#000',
	'-webkit-border-radius':'10px',
	'-moz-border-radius':	'10px',
	'border-radius':		'10px'
}, });
};
</script>
</html>