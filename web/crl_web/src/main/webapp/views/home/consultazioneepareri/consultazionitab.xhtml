<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions">

<pe:tooltip value="Click per Espandere / Comprimere"
	forSelector="legend" shared="true" targetPosition="top center"
	position="left center" />




<div id="blockedConsultazioni">
<p:fieldset legend="Consultazioni" toggleable="true" toggleSpeed="500">
	<p:panelGrid styleClass="infoTable" id="consultazionipanel">
		<p:row>
			<p:column>
				<p:growl id="consultazioneMsg" showDetail="true" sticky="false" />

				<!-- Confirm dialog -->
				<p:confirmDialog id="confirmConsultazioneDialog"
					message="Sei sicuro di voler eliminare la Consultazione ?"
					header="Cancellazione Consultazione" severity="alert"
					widgetVar="consultazioneDialog">

					<p:commandButton id="confirmConsultazione" value="Conferma"
						oncomplete="consultazioneDialog.hide()"
						action="#{consultazioniPareriController.removeConsultazione}"
						update="listaConsultazioni, dettagliconsultazionepanel" />
					<p:commandButton id="declineConsultazione" value="Annulla"
						onclick="consultazioneDialog.hide()" type="button" />

				</p:confirmDialog>
				<p:confirmDialog id="confirmSoggettoInvitatoDialog"
					message="Sei sicuro di voler eliminare il Soggetto Invitato ?"
					header="Cancellazione Soggetto Invitato" severity="alert"
					widgetVar="soggettoInvitatoDialog">

					<p:commandButton id="confirmSoggettoInvitato" value="Conferma"
						oncomplete="soggettoInvitatoDialog.hide()"
						action="#{consultazioniPareriController.removeSoggettoInvitato}"
						update="listaSoggettiInvitati" />
					<p:commandButton id="declineSoggettoInvitato" value="Annulla"
						onclick="soggettoInvitatoDialog.hide()" type="button" />

				</p:confirmDialog>

				<p:confirmDialog id="confirmAllegatoConsultazioneDialog"
					message="Sei sicuro di voler eliminare l'allegato ?"
					header="Cancellazione Allegato" severity="alert"
					widgetVar="allegatoConsultazioneDialog">

					<p:commandButton id="confirmAllegatoConsultazioneComponente"
						value="Conferma" oncomplete="allegatoConsultazioneDialog.hide()"
						action="#{consultazioniPareriController.removeAllegatoConsultazione}"
						update="listaDocumentazioneConsultazione" />
					<p:commandButton id="declineAllegatoConsultazione" value="Annulla"
						onclick="allegatoConsultazioneDialog.hide()" type="button" />

				</p:confirmDialog>

				<p:confirmDialog id="uploadFileConsultazioneAttributes"
					header="Caricamento"
					widgetVar="uploadFileConsultazioneAttributesDialog"
					style="width:450px" message="Allega Testo">
					<p:panelGrid id="uploadpanelConsultazione">
						<p:row>
							<p:column>
								<h:outputLabel for="ispubblicoConsultazione" value="Pubblico: " />
								<p:selectBooleanCheckbox id="ispubblicoConsultazione"
									value="#{consultazioniPareriController.currentFilePubblico}">
									<p:ajax event="change" immediate="true"></p:ajax>
								</p:selectBooleanCheckbox>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:fileUpload label="Carica Allegato"
									oncomplete="uploadFileConsultazioneAttributesDialog.hide()"
									auto="false"
									update="listaDocumentazioneConsultazione, pareriMsg"
									fileUploadListener="#{consultazioniPareriController.uploadAllegatoConsultazione}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:commandButton id="declineUploadFileConsultazione"
									value="Annulla"
									onclick="uploadFileConsultazioneAttributesDialog.hide()"
									type="button" />
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:confirmDialog>
			</p:column>
		</p:row>
		<p:row>
			<p:column colspan="4">
				<p:panelGrid id="addConsultazionePanel" styleClass="tableAppend">
					<f:facet name="header">
						<p:row>
							<p:column>Data Consultazione</p:column>
							<p:column>Soggetto Consultato</p:column>
							<p:column>Documenti</p:column>
							<p:column></p:column>
						</p:row>
					</f:facet>
					<p:row>
						<p:column>
							<p:calendar size="10" locale="it_IT" id="dataConsultazione"
								pattern="dd/MM/yyyy"
								value="#{consultazioniPareriController.dataConsultazione}" />
						</p:column>


						<p:column>
							<p:inputText id="nomeSoggettoConsultato"
								value="#{consultazioniPareriController.soggettoConsultato}" />
						</p:column>

						<p:column>
							<p:commandButton value="Aggiungi"
								action="#{consultazioniPareriController.addConsultazione}"
								id="addConsultazione"
								update="listaConsultazioni, consultazioneMsg, dettagliconsultazionepanel"
								icon="new-icon" />
						</p:column>

					</p:row>

				</p:panelGrid>
			</p:column>
		</p:row>

		<p:row>
			<p:column colspan="4">

				<p:dataTable id="listaConsultazioni"
					value="#{consultazioniPareriController.consultazioniList}"
					var="consultazione" styleClass="generalInfoTab grey-text">

					<p:column
						sortBy="#{consultazioniPareriController.descrizioneConsultazioneSelected}">
						<p:commandButton value="Mostra dettaglio" icon="detail-icon"
							action="#{consultazioniPareriController.showConsultazioneDetail}"
							update=":consultazioniPareriForm:tabView:dettagliconsultazionepanel">
							<f:setPropertyActionListener value="#{consultazione.descrizione}"
								target="#{consultazioniPareriController.descrizioneConsultazioneSelected}" />
						</p:commandButton>
					</p:column>

					<p:column sortBy="#{consultazione.commissione}">
						<f:facet name="header">Commissione</f:facet>
						<h:outputText value="#{consultazione.commissione}" />
					</p:column>

					<p:column sortBy="#{consultazione.dataConsultazione}">
						<f:facet name="header">Data Consultazione</f:facet>
						<h:outputText value="#{consultazione.dataConsultazione}">
							<f:convertDateTime locale="it_IT" pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column sortBy="#{consultazione.descrizione}">
						<f:facet name="header">Soggetti Consultati</f:facet>
						<h:outputText value="#{consultazione.descrizione}" />
					</p:column>




					<p:column>
						<f:facet name="header">Documenti</f:facet>

					</p:column>

					<p:column>
						<f:facet name="header">Elimina</f:facet>

						<p:commandButton oncomplete="consultazioneDialog.show()"
							icon="delete-icon">

							<f:setPropertyActionListener value="#{consultazione.descrizione}"
								target="#{consultazioniPareriController.consultazioneToDelete}" />
						</p:commandButton>
					</p:column>

				</p:dataTable>
			</p:column>
		</p:row>
		<p:row>
			<p:column colspan="6">
				<p:fieldset legend="Dettagli consultazione" collapsed="false"
					toggleable="true" toggleSpeed="500">
					<p:panelGrid styleClass="infoTable" id="dettagliconsultazionepanel">

						<p:row>
							<p:column>
								<b> <h:outputLabel for="commissioniSel" value="Commissione: " />
								</b>
							</p:column>
							<p:column>

								<p:selectOneMenu id="commissioniSel" style="align: right"
									value="#{consultazioniPareriController.consultazioneSelected.commissione}">
									<f:selectItem itemLabel="Scegli una Commissione"
									itemValue="" /> 
									<f:selectItems
										value="#{consultazioniPareriController.commissioni}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<b> <h:outputLabel for="dataseduta" value="Data seduta: " />
								</b>
							</p:column>
							<p:column>
								<p:calendar size="10" locale="it" id="dataseduta"
									value="#{consultazioniPareriController.dataSedutaConsultazione}" />
							</p:column>
							<p:column>
								<h:outputText style="font-weight: bold;" value="Prevista: " />
							</p:column>
							<p:column>
								<p:selectBooleanCheckbox id="prevista"
									value="#{consultazioniPareriController.prevista}">
								</p:selectBooleanCheckbox>
							</p:column>
							<p:column>
								<h:outputText style="font-weight: bold;" value="Discussa: " />
							</p:column>
							<p:column>
								<p:selectBooleanCheckbox id="discussa"
									value="#{consultazioniPareriController.discussa}">
								</p:selectBooleanCheckbox>
							</p:column>

						</p:row>

						<p:row>
							<p:column>
								<b> <h:outputLabel for="dataconsultazione"
										value="Data consultazione: " /> </b>
							</p:column>
							<p:column>
								<p:inputText id="dataconsultazione" readonly="true"
									value="#{consultazioniPareriController.consultazioneSelected.dataConsultazione}">
									<f:convertDateTime locale="it_IT" pattern="dd/MM/yyyy" />
								</p:inputText>
							</p:column>
						</p:row>

						<p:row>
							<p:column>
								<h:outputText style="font-weight: bold;" value="Note: " />
							</p:column>
							<p:column colspan="6">
								<p:inputTextarea rows="2" cols="82" id="noteConsultazione"
									value="#{consultazioniPareriController.noteConsultazione}" />
							</p:column>
						</p:row>

						<p:row>
							<p:column colspan="3">
								<p:panelGrid id="addSoggettoInvitatoPanel"
									styleClass="tableAppend">
									<f:facet name="header">
										<p:row>
											<p:column>Soggetto Invitato</p:column>
											<p:column>Intervenuto</p:column>
											<p:column></p:column>
										</p:row>
									</f:facet>
									<p:row>

										<p:column>
											<p:inputText id="nomeSoggettoInvitato"
												value="#{consultazioniPareriController.nomeSoggettoInvitato}" />
										</p:column>

										<p:column>
											<p:selectBooleanCheckbox id="soggettoInvitatoIntervenuto"
												value="#{consultazioniPareriController.intervenuto}" />
										</p:column>

										<p:column>
											<p:commandButton value="Aggiungi"
												action="#{consultazioniPareriController.addSoggettoInvitato}"
												id="addSoggettoInvitato"
												update="listaSoggettiInvitati, consultazioneMsg"
												icon="new-icon" />
										</p:column>

									</p:row>

								</p:panelGrid>
							</p:column>
						</p:row>

						<p:row>
							<p:column colspan="3">

								<p:dataTable id="listaSoggettiInvitati"
									value="#{consultazioniPareriController.soggettiInvitatiList}"
									var="soggettoInvitato" styleClass="generalInfoTab grey-text">

									<p:column sortBy="#{soggettoInvitato.descrizione}">
										<f:facet name="header">Soggetti Invitati</f:facet>
										<h:outputText value="#{soggettoInvitato.descrizione}" />
									</p:column>

									<p:column sortBy="#{soggettoInvitato.intervenuto}">
										<f:facet name="header">Intervenuti</f:facet>
										<h:outputText value="si"
											rendered="#{soggettoInvitato.intervenuto}" />
										<h:outputText value="no"
											rendered="#{!soggettoInvitato.intervenuto}" />

									</p:column>

									<p:column>
										<f:facet name="header">Elimina</f:facet>

										<p:commandButton oncomplete="soggettoInvitatoDialog.show()"
											icon="delete-icon">

											<f:setPropertyActionListener
												value="#{soggettoInvitato.descrizione}"
												target="#{consultazioniPareriController.soggettoInvitatoToDelete}" />
										</p:commandButton>
									</p:column>

								</p:dataTable>
							</p:column>
						</p:row>

						<p:row>
							<p:column>
									&nbsp;
								</p:column>
						</p:row>

						<!-- <p:row>
							<p:column colspan="4">
								<table class="generalInfoTab grey-text"
									id="documentazioneallegatatab" style="width: 100%;" border="0">
									<thead>
										<th colspan="2">Documentazione allegata</th>
										<th>Documento</th>
										<th>Pubblico</th>
										<th>Opzioni</th>
									</thead>

									TODO: 
							da implementare la cencellazione e l'aggiunta delle righe sugli opportuni tasti già inseriti
							il campo "download" è da implementare con l'opportuno tag <p:filedownload/>

									<tbody>
										<tr>
											<td align="left" colspan="2">Allegato 1</td>
											<td align="left"><h:commandLink>
													<h:outputText value="download" />
												</h:commandLink></td>
											<td align="left"><p:selectBooleanCheckbox /></td>
											<td align="left"><h:graphicImage alt="delete"
													value="/resources/img/delete.png" /></td>

										</tr>

										<tr>
											<td align="left" colspan="2">Allegato 2</td>
											<td align="left"><h:commandLink>
													<h:outputText value="download" />
												</h:commandLink></td>
											<td align="left"><p:selectBooleanCheckbox /></td>
											<td align="left"><h:graphicImage alt="delete"
													value="/resources/img/delete.png" /></td>

										</tr>

									</tbody>
								</table>
							</p:column>
						</p:row> -->

						<p:row>
							<p:column colspan="4">


								<p:commandButton value="Carica Allegato"
									oncomplete="uploadFileConsultazioneAttributesDialog.show()">
								</p:commandButton>


							</p:column>
						</p:row>
						<p:row>
							<p:column colspan="4">

								<p:dataTable id="listaDocumentazioneConsultazione"
									value="#{consultazioniPareriController.consultazioneSelected.allegati}"
									var="allegato" styleClass="generalInfoTab grey-text">

									<p:column sortBy="#{allegato.nome}">
										<f:facet name="header">Documentazione allegata</f:facet>
										<h:outputText value="#{allegato.nome}" />
									</p:column>

									<p:column sortBy="#{allegato.mimetype}">
										<f:facet name="header">Documento</f:facet>
										<h:outputText value="#{allegato.mimetype}" />
									</p:column>

									<p:column sortBy="#{allegato.pubblico}">
										<f:facet name="header">Pubblico</f:facet>
										<h:outputText value="si" rendered="#{allegato.pubblico}" />
										<h:outputText value="no" rendered="#{!allegato.pubblico}" />
									</p:column>

									<p:column>
										<f:facet name="header">Elimina</f:facet>
										<p:commandButton
											oncomplete="allegatoConsultazioneDialog.show()"
											icon="delete-icon">

											<f:setPropertyActionListener value="#{allegato.id}"
												target="#{consultazioniPareriController.allegatoConsultazioneToDelete}" />
										</p:commandButton>
									</p:column>

									<p:column>
										<f:facet name="header">Download</f:facet>

										<p:commandButton id="downloadLinkemendamento"
											icon="detail-icon" ajax="false"
											onclick="PrimeFaces.monitorDownload(start, stop)">
											<f:setPropertyActionListener value="#{allegato.id}"
												target="#{fileDownloadController.fileId}" />
											<f:setPropertyActionListener value="#{allegato.nome}"
												target="#{fileDownloadController.fileName}" />
											<f:setPropertyActionListener value="#{allegato.mimetype}"
												target="#{fileDownloadController.fileMimetype}" />
											<p:fileDownload value="#{fileDownloadController.file}" />
										</p:commandButton>

									</p:column>


								</p:dataTable>




							</p:column>
						</p:row>


						<p:row>
							<p:column colspan="2">
								<p:commandButton value="Salva Consultazioni"
									action="#{consultazioniPareriController.salvaConsultazione}"
									update="consultazioneMsg" />
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:fieldset>
			</p:column>
		</p:row>
	</p:panelGrid>
</p:fieldset>
</div>
<script type="text/javascript" src="resources/javascript/blockUI.js"></script>
<script>
		
if (#{navigationBean.isGuest()}==true) {
	$.blockUI.defaults.overlayCSS.opacity = 0; 
	$('#blockedConsultazioni').block({ message: null } );}
</script>

</html>