<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pe="http://primefaces.org/ui/extensions">

<pe:tooltip value="Click per Espandere / Comprimere"
	forSelector="legend" shared="true" targetPosition="top center"
	position="left center" />
	

<p:panelGrid styleClass="infoTable" id="votazionePanel1">
	<p:row>
		<p:column>
			<!-- Messaggio azioni -->
			<p:growl id="votazioneMsg" showDetail="true" sticky="false" />



			<!-- Confirm dialog -->
			<p:confirmDialog id="confirmAttoDialog"
				message="Sei sicuro di voler eliminare il File ?"
				header="Cancellazione Testo Atto" severity="alert"
				widgetVar="testoAttoDialog">

				<p:commandButton id="confirmTestoAtto" value="Conferma"
					oncomplete="testoAttoDialog.hide()"
					action="#{esameAulaController.removeTestoAttoVotato}"
					update="listaTestiAtto" />
				<p:commandButton id="declineTestoAtto" value="Annulla"
					onclick="testoAttoDialog.hide()" type="button" />

			</p:confirmDialog>
			
			<p:confirmDialog id="uploadFileAttributesVotazione" header="Caricamento"
				widgetVar="uploadFileAttributesVotazioneDialog" style="width:450px"
				message="Allega Testo">
				<p:panelGrid id="uploadpanelVotazione">
					<p:row>
						<p:column>
							<h:outputLabel for="isPubblicoVotazione" value="Pubblico: " />
							<p:selectBooleanCheckbox id="isPubblicoVotazione"
								value="#{esameAulaController.currentFilePubblico}">
								<p:ajax event="change" immediate="true"></p:ajax>
							</p:selectBooleanCheckbox>
						</p:column>
					</p:row>
					<p:row>
						<p:column>
							<p:fileUpload label="Carica Testo dell'Atto"
								oncomplete="uploadFileAttributesVotazioneDialog.hide()" auto="false"
								update="listaTestiAtto ,votazioneMsg"
								fileUploadListener="#{esameAulaController.uploadTestoAttoVotato}" />
						</p:column>
					</p:row>
					<p:row>
						<p:column>
							<p:commandButton id="declineUploadFileVotazione" value="Annulla"
								onclick="uploadFileAttributesVotazioneDialog.hide()" type="button" />
						</p:column>
					</p:row>
				</p:panelGrid>
			</p:confirmDialog>
		</p:column>
	</p:row>
	
	<p:row>
	
		<p:column>
		
		
		Data presa in carico:
		</p:column>
		<p:column><div id="DataPresaInCaricoDiv">
			<p:calendar size="10" locale="it"
				value="#{esameAulaController.dataPresaInCarico}">
				<p:ajax event="dateSelect"
					listener="#{esameAulaController.updateVotazioneHandler}" />
			</p:calendar>
			</div>
		</p:column>
		<p:column><div id="presaInCaricoDiv">
			<p:commandButton value="Presa in carico" 
			action="#{esameAulaController.presaInCarico}"
			update="votazioneMsg , :informationForm:informationBar" oncomplete="unblockDiv()"/>
			</div>
		</p:column>
		
	</p:row>
	<p:row>
		<p:column>
		Relazione scritta:
		</p:column>
		<p:column>
			<p:selectOneMenu id="relazioneScritta"
				value="#{esameAulaController.relazioneScritta}">
				<f:selectItem itemLabel="Sì" itemValue="Sì" />
				<f:selectItem itemLabel="No" itemValue="No" />
				<p:ajax event="change"
					listener="#{esameAulaController.updateVotazioneHandler}" />
			</p:selectOneMenu>
		</p:column>
	</p:row>
	
</p:panelGrid>
<div  id="blockedVotazione">
<p:panelGrid styleClass="infoTable" id="votazionePanel2">
	<p:row>
		<p:column>
		
			<p:fieldset styleClass="fieldSetTab" legend="Esame in assemblea: "
				collapsed="false" toggleable="true" toggleSpeed="500">
				<p:panelGrid styleClass="infoTable" id="esameinassemblea">
					<p:row>
					<p:column>

					Tipologia votazione: 

						</p:column>
						<p:column>
							<p:selectOneMenu id="tipologiaVotazione"
								value="#{esameAulaController.tipologiaVotazione}">
								<f:selectItem itemLabel="Scegli tipologia votazione"
									itemValue="" />
								<f:selectItem itemLabel="Palese per alzata di mano"
									itemValue="Palese per alzata di mano" />
								<f:selectItem itemLabel="Palese per appello nominale"
									itemValue="Palese per appello nominale" />
								<f:selectItem itemLabel="Segreta" itemValue="Segreta" />
								<p:ajax event="change"
									listener="#{esameAulaController.updateVotazioneHandler}" />
							</p:selectOneMenu>
						</p:column>
					
					</p:row>
					<p:row>
						<p:column>
					Esito votazione:</p:column>
						<p:column>
							<p:selectOneMenu id="esitoVotazione"
								value="#{esameAulaController.esitoVotazione}">
								<f:selectItem itemLabel="Scegli votazione" itemValue="" />
								<f:selectItem itemLabel="Approvato" itemValue="Approvato" />
								<f:selectItem itemLabel="Approvato con passaggio all'esame"
									itemValue="Approvato con passaggio all'esame" />
								<f:selectItem itemLabel="Respinto dall'aula"
									itemValue="Respinto dall'aula" />
								<p:ajax event="change"
									listener="#{esameAulaController.updateVotazioneHandler}" />
							</p:selectOneMenu>
						</p:column>
					
						
					</p:row>

					<p:row>
						<p:column>

					Data seduta: 

						</p:column>
						<p:column>
							<p:calendar size="10" locale="it" id="dataSedutaVotazione"
								value="#{esameAulaController.dataSedutaVotazione}">
								<p:ajax event="dateSelect"
									listener="#{esameAulaController.updateVotazioneHandler}" />
							</p:calendar>
						</p:column>

					</p:row>
					<p:row>
						<p:column>Numero DCR:</p:column>
						<p:column>
							<p:inputText size="5" maxlength="5" id="numeroDcr"
								value="#{esameAulaController.numeroDcr}">
								<p:ajax event="change"
									listener="#{esameAulaController.updateVotazioneHandler}" />
							</p:inputText>
						</p:column>
						<p:column>Numero LCR:</p:column>
						<p:column>
							<p:column>
								<p:inputText size="5" maxlength="5" id="numeroLcr"
									value="#{esameAulaController.numeroLcr}">
									<p:ajax event="change"
										listener="#{esameAulaController.updateVotazioneHandler}" />
								</p:inputText>
							</p:column>
						</p:column>
					</p:row>

					<p:row>
						<p:column>

					Emendato: 

						</p:column>


						<p:column>
							<p:selectBooleanCheckbox value="#{esameAulaController.emendato}">
								<p:ajax event="change"
									listener="#{esameAulaController.updateVotazioneHandler}" />
							</p:selectBooleanCheckbox>
						</p:column>


					</p:row>

					<p:row>
						<p:column>

					Note: 

						</p:column>

						<p:column>
							<p:inputTextarea rows="3" cols="60"
								value="#{esameAulaController.noteVotazione}">
								<p:ajax event="change"
									listener="#{esameAulaController.updateVotazioneHandler}" />
							</p:inputTextarea>
						</p:column>


						<p:column>

							<p:commandButton value="Salva"
								action="#{esameAulaController.salvaVotazione}"
								update="votazioneMsg, :informationForm:informationBar" />

						</p:column>
					</p:row>
				</p:panelGrid>
			</p:fieldset>
		</p:column>
	</p:row>

	<p:row>
		<p:column>
			<p:fieldset styleClass="fieldSetTab"
				legend="Testo dell'Atto votato: " collapsed="false"
				toggleable="true" toggleSpeed="500">

				<p:row>
					<!-- <p:column>
					<h:graphicImage alt="add" value="/resources/img/add.png" />
				</p:column>-->
					<p:column colspan="3">
						
							<p:commandButton value="Carica Testo dell'Atto"
						oncomplete="uploadFileAttributesVotazioneDialog.show()">
					</p:commandButton>
					</p:column>
				</p:row>
				<p:row>
					<p:column colspan="4">
						<h:dataTable id="listaTestiAtto"
							value="#{esameAulaController.testiAttoVotatoList}"
							var="testoAttoVotato" styleClass="generalInfoTab grey-text">

							<h:column>
								<f:facet name="header">Testo Dell'Atto</f:facet>
							#{testoAttoVotato.nome}
						</h:column>

							<h:column>
								<f:facet name="header">Azioni</f:facet>
								<h:outputText
									value="#{fn:substring(testoAttoVotato.nome, fn:indexOf(testoAttoVotato.nome,'.')+1 ,fn:length(testoAttoVotato.nome) )}" />

							</h:column>

							<h:column>
								<f:facet name="header">Pubblico</f:facet>
								<h:outputText value="si" rendered="#{testoAttoVotato.pubblico}" />
								<h:outputText value="no" rendered="#{!testoAttoVotato.pubblico}" />
							</h:column>

							<h:column>
								<f:facet name="header">Elimina</f:facet>
								<p:commandButton oncomplete="testoAttoDialog.show()"
									icon="delete-icon">

									<f:setPropertyActionListener value="#{testoAttoVotato.id}"
										target="#{esameAulaController.testoAttoVotatoToDelete}" />
								</p:commandButton>
							</h:column>
							
							<h:column>
							<f:facet name="header">Download</f:facet>

							<p:commandButton id="downloadLink" icon="detail-icon"
								ajax="false" onclick="PrimeFaces.monitorDownload(start, stop)">
								<f:setPropertyActionListener value="#{testoAttoVotato.id}"
									target="#{fileDownloadController.fileId}" />
								<f:setPropertyActionListener value="#{testoAttoVotato.nome}"
									target="#{fileDownloadController.fileName}" />
								<f:setPropertyActionListener value="#{testoAttoVotato.mimetype}"
									target="#{fileDownloadController.fileMimetype}" />
								<p:fileDownload value="#{fileDownloadController.file}" />
							</p:commandButton>

						</h:column>


						</h:dataTable>
					</p:column>
				</p:row>

			</p:fieldset>
		</p:column>
	</p:row>
</p:panelGrid>


</div>
<script type="text/javascript" src="resources/javascript/blockUI.js"></script>
<script>


if (! ("#{esameAulaController.dataPresaInCarico}").length) {
$('#blockedVotazione').block({ message: 'Pagina bloccata!<br />Prendere in carico per sbloccare.', css: {
	width:		'350px',
	top:		'10px',
	left:		'',
	right:		'10px',
	border:		'none',
	padding:	'5px',
	opacity:	0.6,
	cursor:		'default',
	color:		'#fff',
	backgroundColor: '#000',
	'-webkit-border-radius':'10px',
	'-moz-border-radius':	'10px',
	'border-radius':		'10px'
}, });
};


function unblockDiv() { 
    $('#blockedVotazione').unblock(); 
    $('#blockedEmendamenti').unblock(); 
    $('#blockedRinvioStralci').unblock(); 
    $('#blockedNote').unblock(); 
   };
   
if ( #{navigationBean.esameAulaDisabled()}==true) {
   $.blockUI.defaults.overlayCSS.opacity = 0; 
   $('#presaInCaricoDiv').block({ message: null } );
   $('#DataPresaInCaricoDiv').block({ message: null } ); }
</script>

</html>